"use strict";var _createClass=function(){function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}();function _asyncToGenerator(e){return function(){var l=e.apply(this,arguments);return new Promise(function(i,s){return function t(e,a){try{var n=l[e](a),r=n.value}catch(e){return void s(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});i(r)}("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Mark=function(){function t(e){_classCallCheck(this,t),this.ele=document.querySelector(e),this.init()}var e;return _createClass(t,[{key:"init",value:function(){var a=this;this.tbody=this.ele.querySelector("tbody"),this.tfoot=this.ele.querySelector("tfoot"),this.form_box=document.querySelector(".form_box"),this.alter=document.querySelector(".alter"),this.flag=!1,this.Arr=[],this.body=document.querySelector("body"),this.checkbox_all=this.ele.querySelector(".checkbox_all"),this.txt=this.ele.querySelector(".txt"),this.page=this.ele.querySelector(".page"),this.btn=this.ele.querySelector(".btn"),this.form_box=document.querySelector(".form_box"),this.name=this.form_box.querySelector("#name"),this.number=this.form_box.querySelector("#number"),this.chinese=this.form_box.querySelector("#chinese"),this.math=this.form_box.querySelector("#math"),this.english=this.form_box.querySelector("#english"),this.remark=this.form_box.querySelector("#remark"),this.reward=this.form_box.querySelector("#reward"),this.getData(),this.ele.onclick=function(e){var t=e.target;a.id=t.getAttribute("idx"),t.classList.contains("btn")&&(a.form_box.style.display="block",a.name.removeAttribute("disabled"),a.number.removeAttribute("disabled")),t.classList.contains("checkbox_all")&&(a.check_box=a.ele.querySelectorAll(".check_box"),t.checked?a.check_box.forEach(function(e){e.checked=!0}):a.check_box.forEach(function(e){e.checked=!1})),t.classList.contains("check_box")&&(a.check_box=a.ele.querySelectorAll(".check_box"),a.sign=!0,a.Arr=[],a.check_box.forEach(function(e){e.checked?a.Arr.push(e.getAttribute("idx")):a.sign=!1}),a.sign&&(a.checkbox_all.checked=!0)),t.classList.contains("dele")&&a.deleData(),t.classList.contains("cancel")&&a.deleData2(),t.classList.contains("alter")&&(a.form_box.style.display="block",a.name.setAttribute("disabled","disabled"),a.number.setAttribute("disabled","disabled"),e=a.data.filter(function(e){return e.number==a.id}),a.name.value=e[0].name,a.number.value=e[0].number,a.chinese.value=e[0].chinese,a.math.value=e[0].math,a.english.value=e[0].english),t.classList.contains("seek")&&a.search(),t.classList.contains("all")&&a.render(),t.classList.contains("stu_num")&&a.rank()},this.form_box.onclick=function(e){e.target;if("close"==e.target.id&&(a.form_box.style.display="none"),"createData"==e.target.id){if(!(a.name.value&&a.number.value&&a.chinese.value&&math.value&&english.value))return alert("还有内容没填"),void(a.name.value=a.number.value=a.chinese.value=a.math.value=a.english.value=null);a.addData()}},this.body.onclick=function(e){e.target.classList.contains("li_a")&&(a.chart("main","chinese"),a.chart("main2","math"),a.chart("main3","english"))}}},{key:"getData",value:(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pAjax({url:"../api/getData.php",type:"post"});case 2:t=e.sent,this.data=JSON.parse(t),console.log(this.data),this.data.forEach(function(e){e.is_select=!1}),this.render();case 7:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"render",value:function(){var e,t=" ";this.datas=this.dat||this.data;var a=0,n=0,r=0,i=0;this.datas.forEach(function(e){t+="\n            <tr>\n                <td>"+e.number+"</td>\n                <td>"+e.name+"</td>\n                <td>"+e.chinese+"</td>\n                <td>"+e.math+"</td>\n                <td>"+e.english+"</td>\n                <td>"+e.reward+"</td>\n                <td>"+e.remark+'</td>\n                <td>\n                    <button class="dele" idx="'+e.number+'">删除</button>\n                    <button class="alter" idx="'+e.number+'">修改</button>\n                    <input class="check_box" idx="'+e.number+'" type="checkbox">\n                </td>\n            </tr>\n        ',a+=+e.chinese,n+=+e.math,r+=+e.english,i=i+ +e.chinese+ +e.chinese+ +e.chinese}),e="\n            <th>语文平均分</th>\n            <th>"+(a/this.datas.length).toFixed(2)+"</th>\n            <th>数学平均分</th>\n            <th>"+(n/this.datas.length).toFixed(2)+"</th>\n            <th>英语平均分</th>\n            <th>"+(r/this.datas.length).toFixed(2)+"</th>\n            <th>总分平均分</th>\n            <th>"+(i/this.datas.length).toFixed(2)+"</th>\n\n        ",this.dat=null,this.tbody.innerHTML=t,this.tfoot.innerHTML=e}},{key:"deleData",value:function(){var t=this;pAjax({url:"../api/deleData.php",type:"post",data:{number:this.id}}).then(function(e){(e=JSON.parse(e))&&(t.data=t.data.filter(function(e){return e.number!=t.id})),t.render()})}},{key:"deleData2",value:function(){var t=this,e=this.Arr.join(",");pAjax({url:"../api/deleData2.php",type:"post",data:{arr:e}}).then(function(e){console.log(e),e=JSON.parse(e),console.log(t.data),e&&(t.data=t.data.filter(function(e){return!t.Arr.includes(e.number)})),console.log(t.data),t.render()})}},{key:"addData",value:function(){var a=this,n=+this.chinese.value+ +this.math.value+ +this.english.value;pAjax({url:"../api/T_scoreRecord.php",type:"post",data:{name:this.name.value,number:this.number.value,chinese:this.chinese.value,math:this.math.value,english:this.english.value,reward:n,remark:this.remark.value}}).then(function(e){var t;JSON.parse(e).code?a.data.some(function(e){return e.name==a.name.value&&e.number==a.number.value})?(t=a.data.filter(function(e){return e.name==a.name.value&&e.number==a.number.value}),e=a.data.indexOf(t[0]),t={number:a.number.value,name:a.name.value,chinese:a.chinese.value,math:a.math.value,english:a.english.value,remark:a.remark.value,reward:n},a.data.splice(e,1,t)):(t={number:a.number.value,name:a.name.value,chinese:a.chinese.value,math:a.math.value,english:a.english.value,remark:a.remark.value,reward:n},a.data.push(t)):alert("学号或名字错误"),a.render(),a.name.value=a.number.value=a.chinese.value=a.math.value=a.english.value=null})}},{key:"search",value:function(){var t=this;this.dat=this.data.filter(function(e){return e.number==t.txt.value}),this.txt.value=null,this.render()}},{key:"rank",value:function(){this.flag?(this.data.sort(function(e,t){return e.number-t.number}),this.flag=!1):(this.data.sort(function(e,t){return t.number-e.number}),this.flag=!0),this.render()}},{key:"paginate",value:function(){var e=this.data.length;new Pagination(this.page,{pageInfo:{pagenum:1,pagesize:2,total:e,totalpage:Math.ceil(e/2)}})}},{key:"chart",value:function(e,t){var a=[],n=0,r=0,i=0,s=0,l=0;this.data.forEach(function(e){switch(parseInt(+e[t]/10)){case 0:case 1:case 2:case 3:case 4:case 5:n++;break;case 6:r++;break;case 7:i++;break;case 8:s++;break;case 9:case 10:l++}}),a.push(n,r,i,s,l);e=echarts.init(document.getElementById(e)),a={title:{text:t},tooltip:{},legend:{data:["分数"]},xAxis:{data:["60分以下","60~70","70~80","80~90","90~100"]},yAxis:{},series:[{name:"分数",type:"bar",data:a}]};e.setOption(a)}}]),t}();new Mark(".family");